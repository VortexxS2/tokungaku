<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokungaku - Visual Music Composition on Images</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/midi-writer-js@3.1.1/browser/midiwriter.min.js"></script>
</head>
<body>
    <header>
        <h1>Tokungaku</h1>
        <div class="controls">
            <div class="transport-controls">
                <button id="play-btn" title="Play (Space)">▶</button>
                <button id="stop-btn" title="Stop (Space)">■</button>
                <label for="bpm">BPM:</label>
                <input type="number" id="bpm" min="40" max="300" value="120">
            </div>
            <div class="instrument-control">
                <label for="instrument-select">Instrument:</label>
                <select id="instrument-select">
                    <option value="piano">Piano</option>
                    <option value="synth">Synth</option>
                    <option value="bass">Bass</option>
                    <option value="guitar">Guitar</option>
                    <option value="violin">Violin</option>
                    <option value="flute">Flute</option>
                    <option value="drums">Drums</option>
                    <option value="xylophone">Xylophone</option>
                </select>
            </div>
            <div class="grid-controls">
                <label for="time-signature">Time Signature:</label>
                <select id="time-signature">
                    <option value="4" selected>4/4</option>
                    <option value="3">3/4</option>
                    <option value="6">6/8</option>
                </select>
                <label for="steps">Steps:</label>
                <input type="number" id="steps" min="4" max="64" value="32">
            </div>
            <div class="file-controls">
                <button id="export-midi-btn">Export MIDI</button>
                <button id="save-project-btn">Save Project</button>
                <button id="load-project-btn">Load Project</button>
                <button id="new-project-btn">New Project</button>
            </div>
        </div>
    </header>
    
    <main>
        <div class="sidebar">
            <div class="image-controls">
                <input type="file" id="image-upload" accept="image/*" hidden>
                <button id="upload-image-btn">Upload Image</button>
                <button id="remove-image-btn" disabled>Remove Image</button>
            </div>
            <div class="note-controls">
                <h3>Note Options</h3>
                <button id="add-note-btn" title="Add Note (A)">Add Note</button>
                <button id="delete-note-btn" title="Delete Note (D)" disabled>Delete Note</button>
                <div class="note-length">
                    <button id="increase-length-btn" title="Increase Length (W)" disabled>+</button>
                    <button id="decrease-length-btn" title="Decrease Length (S)" disabled>-</button>
                </div>
            </div>
            <div class="grid-appearance">
                <h3>Grid Appearance</h3>
                <div class="color-control">
                    <label for="grid-color">Grid Color:</label>
                    <input type="color" id="grid-color" value="#FFFFFF">
                </div>
                <div class="opacity-control">
                    <label for="grid-opacity">Grid Opacity:</label>
                    <input type="range" id="grid-opacity" min="0" max="100" value="20">
                    <span id="opacity-value">20%</span>
                </div>
            </div>
            <div class="keyboard-shortcuts">
                <h3>Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>A</strong>: Add note</li>
                    <li><strong>D</strong>: Delete selected note</li>
                    <li><strong>W</strong>: Increase note length</li>
                    <li><strong>S</strong>: Decrease note length</li>
                    <li><strong>Arrow keys</strong>: Move selected note</li>
                    <li><strong>Space</strong>: Play/Stop</li>
                </ul>
            </div>
            <div class="usage-guide">
                <h3>Usage</h3>
                <ol>
                    <li>(Optional) Upload a background image.</li>
                    <li>Add notes by clicking on the grid.</li>
                    <li>Adjust note properties using the controls or keyboard shortcuts.</li>
                    <li>Play back the sequence with the play button or spacebar.</li>
                    <li>Save your project to local storage.</li>
                </ol>
            </div>
        </div>
        
        <div class="editor-container">
            <div id="editor-area">
                <div id="image-container"></div>
                <div id="grid-overlay"></div>
                <div id="notes-layer"></div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Tokungaku - Piano Roll Sequencer with Image Background</p>
    </footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/grid.js"></script>
    <script src="js/notes.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
</body>
</html>